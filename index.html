<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
  </head>
  <body>
    <h1>Youtube Playlister</h1>
    <div id="player"></div>
    <h2>Playlist</h2>
    <ol id="playlist"></ol>
    <h2>Add to playlist</h2>
    <form>
      <textarea id="playlist-text" rows="10" cols="100" placeholder="Enter a bunch of Youtube URL" name="urls" autofocus></textarea><br/>
      <input value="Update playlist" type="button" onClick="updatePlaylist();" />
    </form>
    <script>
      var playlistText = document.getElementById("playlist-text");
      var playlist = document.getElementById("playlist");
      function updatePlaylist() {
	  urls = parseURL(playlistText.value)
	  urls = formatURLs(urls);
	  playlist.innerHTML = urls;
      }
      function parseURL(text) {
	  var lines = text.split("\n")
	  patterns = [/(\?|&)v=([^&#]+)/ // For youtube.com/watch&v=video_id
	   	      , /(\.be\/)+([^\/]+)/ // For youtu.be/video_id
	   	      , /(\embed\/)+([^\/]+)/]; // For youtube.com/embed/video_id
	  ids = [];
	  
	  // Match patterns
	  for (i in lines) {
	      if (ids[i] = lines[i].match(patterns[0]).pop()) {
	      } else if (ids[i] = lines[i].match(patterns[1]).pop()) {
	      } else if (ids[i] = lines[i].match(patterns[2]).pop()) {
	      }
	  }
	  
	  return ids;
      }
      function formatURLs(urls) {
	  result = ""
	  for(i in urls){
	      result += "<li>"
		  + "<a href=\"" + urls[i] + "\">"
		  + urls[i]
		  + "</a>"
		  + "</li>"
	  }
	  return result;
      }
      </script>
    <script src="player.js"></script>
  </body>
</html>
